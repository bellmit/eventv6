var g_nMainTimerId=null;var t_btn_state=false;var SOCKETCS;var mainPageSipStateId=null;var IS_SOCKETCS_CLOSE=false;var IS_BUSY=false;var Media=new Audio("");var media_play=0;var G_STAFF_INFO={COMPANY_SN:"fqcf",COMP_WHOLE_NAME:"飞鸟云通讯",COMPANY_ID:"2",STAFF_PWD:"",DEPT_ID:"1",DEPT_NAME:"客服部",ROLE_NAME:"客服代表",STAFF_ID:"30001",STAFF_NAME:"管理员",STAFF_NO:"1",SKILL_GROUP_LIST:"2;1 31 1",EXTEND_STAFF_ID:"1",CONN_NBR:"013809516611",AGENTANI:"",SOFT_PHONE:"3000",BIND_PHONE:"3000",WORK_AFTER_CALL_TIME:0,LOGON_TYPE:1,NOT_PLAY_NO:0,EXT_NBR:0,AUTO_OFFHOOK:0,CALLIN_NOTIFY:1,TERM_SERIAL_NO:"3000",ADDRESS:"192.168.0.10",WS_ADDR:"ws://192.168.0.10",CALLER:"",CALLEE:"",OFFHOOK_VOICE_ADDRESS:"ring.mp3",CALL_ID:"",CALL_TIME:"",DISPLAY_CONSOLE_LOG:false,CONF_URL:""};var NCCCall=function(){};NCCCall.log=function(a,b){if(G_STAFF_INFO.DISPLAY_CONSOLE_LOG){if(b!=undefined){console.log(a+":"+b)}else{console.log(a)}}};NCCCall.el={toolsBar:null,stateBt:null,stateTx:null,D:{btUnCallOut:"btUnCallOut",btCallOut:"btCallOut",btCallIn:"btCallIn",btUnCallIn:"btUnCallIn",btMuteLink:"btMuteLink",btUnMuteLink:"btUnMuteLink",btSetBusy:"btSetBusy",btSetUnBusy:"btSetUnBusy",btHangUp:"btHangUp",btCallTrem:"btCallTrem",btThreeLink:"btThreeLink",btHelp:"btHelp",btHelpCancel:"btHelpCancel",btHelpComf:"btHelpComf",btHelpTransferCall:"btHelpTransferCall",btHelpCut:"btHelpCut",btHelpThreeLink:"btHelpThreeLink",btTransferCall:"btTransferCall",btUnTransferCall:"btUnTransferCall",btSatisfaction:"btSatisfaction"},bt:{btUnCallOut:null,btCallOut:null,btUnCallIn:null,btMuteLink:null,btSetBusy:null,btSetUnBusy:null,btThreeLink:null,btHelp:null,btHelpComf:null,btHelpCancel:null,btHelpTransferCall:null,btHelpCut:null,btHelpThreeLink:null,btCallTrem:null,btTransferCall:null,btUnTransferCall:null,btSatisfaction:null},tools:{},setAllDisabled:function(){NCCCall.el.toolsBar.find(".btn-all").hide();NCCCall.el.toolsBar.find(".btThreeLink").hide();NCCCall.el.toolsBar.find(".btTransferCall").hide();NCCCall.el.toolsBar.find(".btCallOut").show()},setAllUnDisabled:function(){NCCCall.el.toolsBar.find("button").attr("disabled",false)},setPhoneBarEnable:function(b,a){NCCCall.el.toolsBar.find("."+b).attr("disabled",a)},init:function(){NCCCall.el.toolsBar=$(".dev_call_info_tools_bar");NCCCall.el.stateTx=$(".tx_call_state");NCCCall.el.bt.btUnCallOut=NCCCall.el.toolsBar.find(".btUnCallOut");NCCCall.el.bt.btCallOut=NCCCall.el.toolsBar.find(".btCallOut");NCCCall.el.bt.btUnCallIn=NCCCall.el.toolsBar.find(".btUnCallIn");NCCCall.el.bt.btMuteLink=NCCCall.el.toolsBar.find(".btMuteLink");NCCCall.el.bt.btSetBusy=NCCCall.el.toolsBar.find(".btSetBusy");NCCCall.el.bt.btSetUnBusy=NCCCall.el.toolsBar.find(".btSetUnBusy");NCCCall.el.bt.btThreeLink=NCCCall.el.toolsBar.find(".btThreeLink");NCCCall.el.bt.btHelp=NCCCall.el.toolsBar.find(".btHelp");NCCCall.el.bt.btHelpComf=NCCCall.el.toolsBar.find(".btHelpComf");NCCCall.el.bt.btHelpCancel=NCCCall.el.toolsBar.find(".btHelpCancel");NCCCall.el.bt.btHelpTransferCall=NCCCall.el.toolsBar.find(".btHelpTransferCall");NCCCall.el.bt.btHelpCut=NCCCall.el.toolsBar.find(".btHelpCut");NCCCall.el.bt.btHelpThreeLink=NCCCall.el.toolsBar.find(".btHelpThreeLink");NCCCall.el.bt.btCallTrem=NCCCall.el.toolsBar.find(".btCallTrem");NCCCall.el.bt.btTransferCall=NCCCall.el.toolsBar.find(".btTransferCall");NCCCall.el.bt.btUnTransferCall=NCCCall.el.toolsBar.find(".btUnTransferCall");NCCCall.el.bt.btSatisfaction=NCCCall.el.toolsBar.find(".btSatisfaction");NCCCall.el.tools[NCCCall.el.D.btUnCallOut]={el:NCCCall.el.bt.btUnCallOut,t:"呼出",c:"blue-steel",disabled:true,e:function(){NCCCall.currInfo.callType="out";NCCCall.op.makeCall($("[name='callNbr']").val(),NCCCall.op.makeCall.CallType.PHONE)}};NCCCall.el.tools[NCCCall.el.D.btCallOut]={el:NCCCall.el.bt.btCallOut,t:"呼出",c:"blue-steel",disabled:false,e:function(){NCCCall.currInfo.callType="out";NCCCall.op.makeCall($("[name='callNbr']").val(),NCCCall.op.makeCall.CallType.PHONE)}};NCCCall.el.tools[NCCCall.el.D.btCallIn]={el:NCCCall.el.bt.btCallOut,t:"摘机",c:"blue-steel",disabled:false,e:function(){NCCCall.currInfo.callType="in";NCCCall.op.answerCall(null)}};NCCCall.el.tools[NCCCall.el.D.btHangUp]={el:NCCCall.el.bt.btCallOut,t:"挂机",c:"blue-steel",disabled:false,e:function(){NCCCall.op.hangup(null)}};NCCCall.el.tools[NCCCall.el.D.btMuteLink]={el:NCCCall.el.bt.btMuteLink,t:"静音",c:"blue-steel",disabled:false,e:function(){NCCCall.op.muteLink(true,null)}};NCCCall.el.tools[NCCCall.el.D.btUnMuteLink]={el:NCCCall.el.bt.btMuteLink,t:"取消静音",c:"blue-steel",disabled:false,e:function(){NCCCall.op.muteLink(false,null)}};NCCCall.el.tools[NCCCall.el.D.btUnCallIn]={el:NCCCall.el.bt.btUnCallIn,t:"拒接",c:"blue-steel",disabled:false,e:function(){NCCCall.op.hangup(null)}};NCCCall.el.tools[NCCCall.el.D.btSetBusy]={el:NCCCall.el.bt.btSetBusy,t:"示忙",c:"blue-steel",disabled:false,e:function(){NCCCall.op.setBusy(true,null)}};NCCCall.el.tools[NCCCall.el.D.btSetUnBusy]={el:NCCCall.el.bt.btSetBusy,t:"示闲",c:"blue-steel",disabled:false,e:function(){NCCCall.op.setBusy(false,null)}};NCCCall.el.tools[NCCCall.el.D.btCallTrem]={el:NCCCall.el.bt.btCallTrem,t:"内部",c:"blue-steel",disabled:false,e:function(){NCCCall.op.callTerm(null)}};NCCCall.el.tools[NCCCall.el.D.btTransferCall]={el:NCCCall.el.bt.btTransferCall,t:"转接",c:"blue-steel",disabled:false,e:function(){NCCCall.op.transferCall()}};NCCCall.el.tools[NCCCall.el.D.btUnTransferCall]={el:NCCCall.el.bt.btUnTransferCall,t:"取消转接",c:"blue-steel",disabled:false,e:function(){NCCCall.op.transferCancel()}};NCCCall.el.tools[NCCCall.el.D.btSatisfaction]={el:NCCCall.el.bt.btSatisfaction,t:"满意度",c:"blue-steel",disabled:false,e:function(){NCCCall.op.investingation()}};NCCCall.el.tools[NCCCall.el.D.btThreeLink]={el:NCCCall.el.bt.btThreeLink,t:"三通",c:"blue-steel",disabled:false,e:function(){}};NCCCall.el.tools[NCCCall.el.D.btHelp]={el:NCCCall.el.bt.btHelp,t:"互助",c:"blue-steel",disabled:false,e:function(){NCCCall.op.help()}};NCCCall.el.tools[NCCCall.el.D.btHelpCancel]={el:NCCCall.el.bt.btHelpCancel,t:"取消互助",c:"blue-steel",disabled:false,e:function(){NCCCall.op.helpCancel()}};NCCCall.el.tools[NCCCall.el.D.btHelpTransferCall]={el:NCCCall.el.bt.btHelpTransferCall,t:"互助转接",c:"blue-steel",disabled:false,e:function(){NCCCall.op.hangup(null)}};NCCCall.el.tools[NCCCall.el.D.btHelpCut]={el:NCCCall.el.bt.btHelpCut,t:"互助切换",c:"blue-steel",disabled:false,e:function(){NCCCall.op.SwitchCall()}};NCCCall.el.tools[NCCCall.el.D.btHelpThreeLink]={el:NCCCall.el.bt.btHelpThreeLink,t:"互助三通",c:"blue-steel",disabled:false,e:function(){NCCCall.op.confCallPro("1","",null)}};NCCCall.el.tools[NCCCall.el.D.btHelpComf]={el:NCCCall.el.bt.btHelpComf,t:"确认互助",c:"blue-steel",disabled:false,e:function(){NCCCall.op.hangup()}}}};NCCCall.dataAction={msgType:"action",msgId:"",token:"",seq:"",staffId:G_STAFF_INFO.STAFF_ID,companyId:G_STAFF_INFO.COMPANY_ID,callData:"",shortData:"",reserved:""};NCCCall.action={login:"login",logout:"logout",SetBusy:"SetBusy",makeCall:"makeCall",hangup:"hangup",answerCall:"answerCall",muteLink:"muteLink",transferCall:"transferCall",transferCancel:"transferCancel",switchCall:"switchCall",confCall:"confCall",queryAgentState:"queryAgentState",queryQueueState:"queryQueueState",setSpy:"setSpy",barge:"barge",forceDo:"forceDo",investingation:"investingation",playVox:"playVox",recordVox:"recordVox",getDtmf:"getDtmf",confPlay:"confPlay",stopIVR:"stopIVR",setValue:"setValue",getValue:"getValue"};NCCCall.state={D:{stNull:0,stInit:1,stLogging:2,stLogout:3,stSkilling:4,stDeSkilling:5,stIdle:6,stBusy:7,stPreLink:10,stIncoming:11,stDial:12,stRingBack:13,stLink:14,stMuteLink:15,stWorkAfterCallTime:16,stTransfer:20,stConsulting:21,stConsultedLink:22,stConferenced:23,rcsConsultingLink:24,stSpyWait:30,stSpying:31,stBarging:32,stBarged:33,stPlayVox:41,stRecordVox:42,stGetDtmf:43,stPlayOnline:44},F:{s0:{e:"stNull",s:0,c:"不可用",i:"icon-user-unfollow",cl:"red-thunderbird",btSts:[NCCCall.el.D.btUnCallOut]},s1:{e:"stInit",s:1,c:"未注册",i:"icon-user-unfollow",cl:"red-thunderbird",btSts:[NCCCall.el.D.btUnCallOut]},s2:{e:"stLogging",s:2,c:"登录中",i:"icon-users",cl:"yellow-soft",btSts:[NCCCall.el.D.btUnCallOut]},s3:{e:"stLogout",s:3,c:"注销中",i:"icon-users",cl:"yellow-soft",btSts:[NCCCall.el.D.btUnCallOut]},s4:{e:"stSkilling",s:4,c:"注册中",i:"icon-users",cl:"yellow-soft",btSts:[NCCCall.el.D.btUnCallOut]},s5:{e:"stDeSkilling",s:5,c:"注销中",i:"icon-users",cl:"yellow-soft",btSts:[NCCCall.el.D.btUnCallOut]},s6:{e:"stIdle",s:6,c:"空闲",i:"icon-user-following",cl:"blue-soft",btSts:[NCCCall.el.D.btCallOut,NCCCall.el.D.btCallTrem]},s7:{e:"stBusy",s:7,c:"忙碌",i:"icon-user-following",cl:"yellow-gold",btSts:[NCCCall.el.D.btCallOut,NCCCall.el.D.btCallTrem]},s10:{e:"stPreLink",s:10,c:"预占",i:"icon-calendar",cl:"purple-medium",btSts:[NCCCall.el.D.btHangUp]},s11:{e:"stIncoming",s:11,c:"呼入",i:"icon-call-in",cl:"blue",clx:"red-mint",btSts:[NCCCall.el.D.btCallIn,NCCCall.el.D.btUnCallIn]},s12:{e:"stDial",s:12,c:"呼出",i:"icon-call-out",cl:"yellow-gold",btSts:[NCCCall.el.D.btHangUp]},s13:{e:"stRingBack",s:13,c:"回铃",i:"icon-call-out",cl:"yellow-soft",btSts:[NCCCall.el.D.btHangUp]},s14:{e:"stLink",s:14,c:"通话中",i:"",i_in:"icon-call-in",i_out:"icon-call-out",cl:"green-jungle",btSts:[NCCCall.el.D.btHangUp,NCCCall.el.D.btMuteLink,NCCCall.el.D.btHelp,NCCCall.el.D.btTransferCall,NCCCall.el.D.btThreeLink,NCCCall.el.D.btSatisfaction]},s15:{e:"stMuteLink",s:15,c:"静音",i:"icon-volume-off",cl:"green-meadow",btSts:[NCCCall.el.D.btHangUp,NCCCall.el.D.btUnMuteLink]},s16:{e:"stWorkAfterCallTime",s:16,c:"后续处理",i:"icon-user-following",cl:"yellow-gold",btSts:[NCCCall.el.D.btHangUp]},s20:{e:"stTransfer",s:20,c:"转接中",i:"icon-shuffle",cl:"yellow-gold",btSts:[NCCCall.el.D.btHangUp,NCCCall.el.D.btUnTransferCall]},s21:{e:"stConsulting",s:21,c:"请求互助",i:"icon-users",is:"",cl:"yellow-gold",btSts:[NCCCall.el.D.btHangUp,NCCCall.el.D.btHelpCancel]},s22:{e:"stConsultedLink",s:22,c:"互助通话",i:"icon-users",is:"",cl:"green-jungle",btSts:[NCCCall.el.D.btHangUp,NCCCall.el.D.btHelpCut,NCCCall.el.D.btHelpThreeLink,NCCCall.el.D.btHelpTransferCall,NCCCall.el.D.btHelpCancel]},s23:{e:"stConferenced",s:23,c:"会议通话",i:"icon-users",is:"",cl:"green-jungle",btSts:[NCCCall.el.D.btHangUp]},s24:{e:"rcsConsultingLink",s:23,c:"提供互助",i:"icon-users",is:"",cl:"green-jungle",btSts:[NCCCall.el.D.btHangUp]},s30:{e:"stSpyWait",s:30,c:"监听等待",i:"icon-earphones-alt",is:"",cl:"yellow-gold",btSts:[NCCCall.el.D.btHangUp]},s31:{e:"stSpying",s:31,c:"监听中",i:"icon-earphones-alt",is:"",cl:"green-jungle",btSts:[NCCCall.el.D.btHangUp]},s32:{e:"stBarging",s:32,c:"插话中",i:"icon-action-redo",is:"",cl:"green-jungle",btSts:[NCCCall.el.D.btHangUp]},s33:{e:"stBarged",s:33,c:"被插话",i:"icon-action-undo",is:"",cl:"green-jungle",btSts:[NCCCall.el.D.btHangUp]},s41:{e:"stPlayVox",s:41,c:"放音",i:"icon-control-play",cl:"green-jungle",btSts:[NCCCall.el.D.btHangUp]},s42:{e:"stRecordVox",s:42,c:"录音",i:"icon-microphone",cl:"red-flamingo",btSts:[NCCCall.el.D.btHangUp]},s43:{e:"stGetDtmf",s:43,c:"取键",i:"icon-grid",cl:"blue",btSts:[NCCCall.el.D.btHangUp]},s44:{e:"stPlayOnline",s:44,c:"通话放音",i:"icon-volume-2",cl:"green-meadow",btSts:[NCCCall.el.D.btHangUp]}},c:function(a){return NCCCall.state.F["s"+a]!=undefined?NCCCall.state.F["s"+a]["c"]:"未知状态-"+a},a:function(a){return NCCCall.state.F["s"+a]}};NCCCall.event={CallBreak:"CallBreak",Record:"Record",RingBack:"RingBack",CallOut:"CallOut",PreLink:"PreLink",CallIn:"Callin",Establish:"Establish",CallEnd:"CallEnd",StateChanged:"StateChanged",Kickout:"Kickout",Enforced:"Enforced",AgentState:"AgentState",QueueState:"QueueState"};NCCCall.resField={login:["result","remark","token","staffId","termId"],logout:["result","remark","staffId","termId"],makecall:["result","remark"],hangup:["result","remark"],answercall:["result","remark"],setbusy:["result","remark"],mutelink:["result","remark"],transfercall:["result","remark"],transfercancel:["result","remark"],switchcall:["result","remark"],confcall:["result","remark"],setspy:["result","remark"],barge:["result","remark"],queryagentstate:["result","remark"],queryqueuestate:["result","remark"],forcedo:["result","remark"],investingation:["result","remark"],playvox:["result","remark"],confplay:["result","remark"],recordvox:["result","remark"],getdtmf:["result","remark","key"],stopivr:["result","remark"],setvalue:["result","remark"],getvalue:["result","remark","paramName","paramValue"],callbreak:["callId","callSub","hangupTime"],record:["staffId","devId","initPath","recordFile","callId","callSub","caller","callee","type","callTime","duration"],ringback:["callId","callSub","ani","dnis","callTime","userdata"],callout:["callId","callSub","ani","dnis","callTime","result","resultDesc","userdata"],prelink:["callId","callSub","ani","dnis","direction","type","preLinkTime","userdata"],callin:["callId","callSub","ani","dnis","direction","type","callTime","userdata"],establish:["callId","callSub","ani","dnis","direction","establishTime","userdata"],callend:["callId","callSub","ani","dnis","direction","callTime","establishTime","finishTime","duration","hangupType","userdata"],statechanged:["state","stateDesc","stateTime"],kickout:["ip","reason"],enforced:["staffId","staffName","action","reason"],agentstate:["staffId","staffNo","termId","state","stateTime","staffName","staffDept","staffRole","localIP","logonIP","recordFlag","monitorFlag","ani","dnis","longTime","callType","queryMode"],queuestate:["queueId","totalNum","idleNum","talkNum","busyNum","queuedNum"]};NCCCall.op=function(){};NCCCall.op.login=function(c){var b=$.extend({},NCCCall.dataAction,{});b.msgId=NCCCall.action.login;b.seq=new Date().getTime();var a=[G_STAFF_INFO.LOGON_TYPE,G_STAFF_INFO.BIND_PHONE,G_STAFF_INFO.STAFF_ID,G_STAFF_INFO.STAFF_NO,G_STAFF_INFO.STAFF_NAME,G_STAFF_INFO.DEPT_NAME,G_STAFF_INFO.ROLE_NAME,G_STAFF_INFO.EXT_NBR,G_STAFF_INFO.STAFF_PWD,IS_BUSY=="true"?"1":"0",G_STAFF_INFO.SKILL_GROUP_LIST,G_STAFF_INFO.AGENTANI,"",G_STAFF_INFO.NOT_PLAY_NO==1?0:1,G_STAFF_INFO.CONF_URL];b.shortData=NCCCall.getShortData(a);NCCCall.send(b,c)};NCCCall.op.loginPro=function(i,n,d,a,g,c,l,j,f,m,h,b,k){var e=$.extend({},NCCCall.dataAction,{});e.msgId=NCCCall.action.login;e.seq=new Date().getTime();var o=[i,n,d,a,g,c,l,h,j,"0",b,f,m,"1",G_STAFF_INFO.CONF_URL];e.shortData=NCCCall.getShortData(o);NCCCall.send(e,k)};NCCCall.op.forceDoPro=function(d,e,c){var b=$.extend({},NCCCall.dataAction,{});b.msgId=NCCCall.action.forceDo;b.seq=new Date().getTime();var a=[d,e,"强制动作"];b.shortData=NCCCall.getShortData(a);NCCCall.send(b,c)};NCCCall.op.PlayVox=function(g,f,c,b,e){var d=$.extend({},NCCCall.dataAction,{});d.msgId=NCCCall.action.playVox;d.seq=new Date().getTime();var a=[g,f,c,b];d.shortData=NCCCall.getShortData(a);NCCCall.send(d,e)};NCCCall.op.StopIVR=function(c){var b=$.extend({},NCCCall.dataAction,{});b.msgId=NCCCall.action.stopIVR;b.seq=new Date().getTime();var a=[""];b.shortData=NCCCall.getShortData(a);NCCCall.send(b,c)};NCCCall.op.RecordVox=function(f,b,e,d){var c=$.extend({},NCCCall.dataAction,{});c.msgId=NCCCall.action.recordVox;c.seq=new Date().getTime();var a=[f,b,e,"600","#"];c.shortData=NCCCall.getShortData(a);NCCCall.send(c,d)};NCCCall.op.logoutPro=function(a,d){var c=$.extend({},NCCCall.dataAction,{});c.msgId=NCCCall.action.logout;c.seq=new Date().getTime();var b=[G_STAFF_INFO.STAFF_ID,0,"",""];if(a!=null&&a.length>0){b[1]=1;b[2]=a}c.shortData=NCCCall.getShortData(b);clearInterval(g_nMainTimerId);g_nMainTimerId=null;NCCCall.send(c,d);IS_SOCKETCS_CLOSE=true;if(mainPageSipStateId!=null){clearTimeout(mainPageSipStateId);mainPageSipStateId=null}};NCCCall.op.logoutOutline=function(c){var b=$.extend({},NCCCall.dataAction,{});b.msgId=NCCCall.action.logout;b.seq=new Date().getTime();var a=[G_STAFF_INFO.STAFF_ID,0,"",""];b.shortData=NCCCall.getShortData(a);NCCCall.send(b,c);IS_SOCKETCS_CLOSE=true;try{SOCKETCS.close()}catch(d){}SOCKETCS=null};NCCCall.op.makeCall=function(c,a,e){if(NCCCall.currInfo.state!=6&&NCCCall.currInfo.state!=7&&NCCCall.currInfo.state!=16){ncctools.error("当前状态不允许呼出!");return}if(c.replace(/\s/g,"")==""){ncctools.error("请输入电话号码!");return}if(isNaN(c)){}var f=/^[0-9]*$/;if(!f.test(c)){ncctools.error("请输入电话号码不合法!");return}$("#main_call_menu").show();$("#main_callin_title").hide();$("#main_callout_title").show();G_STAFF_INFO.CALLEE=c;var d=$.extend({},NCCCall.dataAction,{});d.msgId=NCCCall.action.makeCall;d.seq=new Date().getTime();var b=[G_STAFF_INFO.AGENTANI,c,c,a,""];d.shortData=NCCCall.getShortData(b);NCCCall.send(d,e)};NCCCall.op.makeCall.CallType={PHONE:0,TERM_ID:1,STAFF_NO:2,STAFF_AGENTANI:3,IVR:4};NCCCall.op.hangup=function(c){var b=$.extend({},NCCCall.dataAction,{});b.msgId=NCCCall.action.hangup;b.seq=new Date().getTime();var a=[""];b.shortData=NCCCall.getShortData(a);NCCCall.send(b,c)};NCCCall.op.answerCall=function(c){var b=$.extend({},NCCCall.dataAction,{});b.msgId=NCCCall.action.answerCall;b.seq=new Date().getTime();var a=[""];b.shortData=NCCCall.getShortData(a);NCCCall.send(b,c)};NCCCall.op.setBusy=function(d,c){var b=$.extend({},NCCCall.dataAction,{});b.msgId=NCCCall.action.SetBusy;b.seq=new Date().getTime();var a=[d?1:0,""];b.shortData=NCCCall.getShortData(a);NCCCall.send(b,c)};NCCCall.op.muteLink=function(d,c){var b=$.extend({},NCCCall.dataAction,{});b.msgId=NCCCall.action.muteLink;b.seq=new Date().getTime();var a=[d?1:0,""];b.shortData=NCCCall.getShortData(a);NCCCall.el.setAllDisabled();NCCCall.send(b,c)};NCCCall.op.investingation=function(c){var b=$.extend({},NCCCall.dataAction,{});b.msgId=NCCCall.action.investingation;b.seq=new Date().getTime();var a=["D00001381","D00001383","1,2,3,4","很满意,满意,一般,不满意"];b.shortData=NCCCall.getShortData(a);NCCCall.send(b,c)};NCCCall.op.SwitchCall=function(c){var b=$.extend({},NCCCall.dataAction,{});b.msgId=NCCCall.action.switchCall;b.seq=new Date().getTime();var a=[""];b.shortData=NCCCall.getShortData(a);NCCCall.send(b,c)};NCCCall.op.transferCallPro=function(a,d,c,f){var e=$.extend({},NCCCall.dataAction,{});e.msgId=NCCCall.action.transferCall;e.seq=new Date().getTime();var b=[NCCCall.currInfo.ani,d,NCCCall.currInfo.dnis,a,d,c,""];e.shortData=NCCCall.getShortData(b);NCCCall.el.setAllDisabled();NCCCall.send(e,f)};NCCCall.op.confCallPro=function(a,c,e){var d=$.extend({},NCCCall.dataAction,{});d.msgId=NCCCall.action.confCall;d.seq=new Date().getTime();var b=[NCCCall.currInfo.ani,c,NCCCall.currInfo.dnis,a,c,0,""];d.shortData=NCCCall.getShortData(b);NCCCall.el.setAllDisabled();NCCCall.send(d,e)};NCCCall.op.confCall=function(e){var b;var d;var c=$("#select-TransferCall-type-modal");c.modal();c.find(".btSelect").unbind("click").click(function(){b=$(this).attr("data-item_type");if(b=="1"){NCCCall.modal.selectSeat(function(f){d=f;a()})}else{NCCCall.modal.inputPhone(function(f){d=f;a()})}c.modal("hide")});function a(){var g=$.extend({},NCCCall.dataAction,{});g.msgId=NCCCall.action.confCall;g.seq=new Date().getTime();var f=[NCCCall.currInfo.ani,d,NCCCall.currInfo.dnis,b,d,0,""];g.shortData=NCCCall.getShortData(f);NCCCall.el.setAllDisabled();NCCCall.send(g,e)}};NCCCall.op.help=function(c){var b;NCCCall.modal.selectSeat(function(d){b=d;a()});function a(){var e=$.extend({},NCCCall.dataAction,{});e.msgId=NCCCall.action.transferCall;e.seq=new Date().getTime();var d=[NCCCall.currInfo.ani,b,NCCCall.currInfo.dnis,1,b,1,""];e.shortData=NCCCall.getShortData(d);NCCCall.el.setAllDisabled();NCCCall.send(e,c)}};NCCCall.op.helpCancel=function(a){NCCCall.op.transferCancel(a)};NCCCall.op.transferCall=function(e){var b;var d;var c=$("#select-TransferCall-type-modal");c.modal();c.find(".btSelect").unbind("click").click(function(){b=$(this).attr("data-item_type");if(b=="1"){NCCCall.modal.selectSeat(function(f){d=f;a()})}else{NCCCall.modal.inputPhone(function(f){d=f;a()})}c.modal("hide")});function a(){var g=$.extend({},NCCCall.dataAction,{});g.msgId=NCCCall.action.transferCall;g.seq=new Date().getTime();var f=[NCCCall.currInfo.ani,d,NCCCall.currInfo.dnis,b,d,0,""];g.shortData=NCCCall.getShortData(f);NCCCall.el.setAllDisabled();NCCCall.send(g,e)}};NCCCall.op.transferCancel=function(c){var b=$.extend({},NCCCall.dataAction,{});b.msgId=NCCCall.action.transferCancel;b.seq=new Date().getTime();var a=[""];b.shortData=NCCCall.getShortData(a);NCCCall.el.setAllDisabled();NCCCall.send(b,c)};NCCCall.op.callTerm=function(a){NCCCall.modal.selectSeat(function(b){var c=b;NCCCall.op.makeCall(c,NCCCall.op.makeCall.CallType.STAFF_NO,function(e,d){if(d.data.result!="Succ"){ncctools.error(d.data.remark)}})})};NCCCall.op.queryAgentState=function(e,f,d,b){var c=$.extend({},NCCCall.dataAction,{});c.msgId=NCCCall.action.queryAgentState;c.seq=new Date().getTime();var a=[e,f,3,"",""];c.shortData=NCCCall.getShortData(a);if(b!=null&&e==0){NCCCall.actionListener.addEventListener(NCCCall.event.AgentState,c.seq,function(i,h){try{b(i,h)}catch(g){}})}NCCCall.send(c,d)};NCCCall.op.QueryQueueState=function(f,a,g,e,c){var d=$.extend({},NCCCall.dataAction,{});d.msgId=NCCCall.action.queryQueueState;d.seq=new Date().getTime();var b=[f,a,g];d.shortData=NCCCall.getShortData(b);if(c!=null&&f==0){NCCCall.actionListener.addEventListener(NCCCall.event.QueueState,d.seq,function(j,i){try{c(j,i)}catch(h){}})}NCCCall.send(d,e)};NCCCall.op.SetValue=function(e,d,c){var b=$.extend({},NCCCall.dataAction,{});b.msgId=NCCCall.action.setValue;b.seq=new Date().getTime();var a=[e,d];b.shortData=NCCCall.getShortData(a);NCCCall.send(b,c)};NCCCall.op.GetValue=function(d,c){var b=$.extend({},NCCCall.dataAction,{});b.msgId=NCCCall.action.getValue;b.seq=new Date().getTime();var a=[d];b.shortData=NCCCall.getShortData(a);NCCCall.send(b,c)};NCCCall.op.queryAgentState.action={QUERY:0,CANCEL:1,CANCEL_ALL:2};NCCCall.op.queryAgentState.mode={QUERY_SIMP:1,QUERY_ONES_SIMP:2,QUERY_DETAIL:3,QUERY_ONES_DETAIL:4};NCCCall.op.Result={Succ:"Succ",Fail:"Fail"};NCCCall.op.SetSpy=function(e,b,d){var c=$.extend({},NCCCall.dataAction,{});c.msgId=NCCCall.action.setSpy;c.seq=new Date().getTime();var a=[e,b];c.shortData=NCCCall.getShortData(a);NCCCall.send(c,d)};NCCCall.op.Barge=function(d,c){var b=$.extend({},NCCCall.dataAction,{});b.msgId=NCCCall.action.barge;b.seq=new Date().getTime();var a=[d];b.shortData=NCCCall.getShortData(a);NCCCall.send(b,c)};NCCCall.modal=function(){};NCCCall.modal.selectSeat=function(a){ncctools.input("座席选择","请输入座席工号",function(b){a(b)})};NCCCall.modal.inputPhone=function(a){ncctools.input("外线选择","请输入外线电话号码",function(b){a(b)})};NCCCall.getShortData=function(c){var b="";for(var a=0;a<c.length;a++){b+=c[a]+"\x01"}return b};NCCCall.genResShortData=function(e,b){var c=b.split("\x01");var d={};for(var a=0;a<e.length;a++){d[e[a]]=c.length>a?c[a]:""}return d};NCCCall.send=function(d,c,b,a){var e=d.msgType+"\x01"+d.msgId+"\x01"+d.token+"\x01"+d.seq+"\x01"+d.staffId+"\x01"+d.companyId+"\x01"+d.reserved+"\x03"+d.callData+"\x03"+d.shortData+"\x01";NCCCall.log("send:",e);if(c!=null&&c!=undefined&&typeof c=="function"){NCCCall.actionListener.addListener(d.msgId,d.seq,c)}if(b!=null&&b!=undefined&&typeof b=="function"){NCCCall.actionListener.addForeverListener(d.msgId,d.seq,b)}if(a!=null&&a!=undefined&&typeof a=="function"){NCCCall.actionListener.addEventListener(d.msgId,d.seq,a)}SOCKETCS.send(e)};NCCCall.actionListener={ones:{},forever:{},actionEvent:{},allEvent:{},allData:{},addListener:function(c,a,b){c=c.toLowerCase();NCCCall.actionListener.ones[c+a]={action:c,fnCallBack:b}},addForeverListener:function(c,a,b){NCCCall.actionListener.forever[c+a]={action:c,fnCallBack:b}},addEventListener:function(c,a,b){NCCCall.actionListener.actionEvent[c+a]={action:c,fnCallBack:b}},delEventListener:function(b,a){if(NCCCall.actionListener.ones[b+a]!=undefined){delete NCCCall.actionListener.ones[b+a]}},addAllEventListener:function(a,b){NCCCall.actionListener.allEvent[a]={action:a,fnCallBack:b}},addAllDataListener:function(a,b){NCCCall.actionListener.allData[a]={action:a,fnCallBack:b}},doListener:function(c){var b=c.data.split("\x03");var f=b[0].split("\x01");var h=f[0];var m=f[1];var i=f[2];var d=b[1];var l=b[2];var a=NCCCall.resField[m.toLowerCase()];var g={msgType:h,msgAction:m,msgSeq:i,callData:d,field:a,data:null};if(a!=undefined){g.data=NCCCall.genResShortData(a,l)}else{g.data=l.split("\x01")}if(h=="Respone"){try{m=m.toLowerCase();if(NCCCall.actionListener.ones[m+i]!=undefined){NCCCall.actionListener.ones[m+i]["fnCallBack"](c.data,g);delete NCCCall.actionListener.ones[m+i]}}catch(j){}try{if(NCCCall.actionListener.forever[m+i]!=undefined){NCCCall.actionListener.forever[m+i]["fnCallBack"](c.data,g)}}catch(j){}}else{if(h=="Event"){try{if(NCCCall.actionListener.actionEvent[m+i]!=undefined){NCCCall.actionListener.actionEvent[m+i]["fnCallBack"](c.data,g);if(m==NCCCall.event.AgentState&&g.data["queryMode"]=="9"){console.log("queryEnd.");delete NCCCall.actionListener.actionEvent[m+i]}}}catch(j){}try{for(var k in NCCCall.actionListener.allEvent){NCCCall.actionListener.allEvent[k]["fnCallBack"](c.data,g)}}catch(j){}try{if(NCCCall.onCallIn&&m==NCCCall.event.CallIn){NCCCall.onCallIn(g.data)}else{if(NCCCall.onKickout&&m==NCCCall.event.Kickout){NCCCall.onKickout(g.data)}else{if(NCCCall.onCallEnd&&m==NCCCall.event.CallEnd){NCCCall.onCallEnd(g.data)}else{if(NCCCall.onCallIn&&m==NCCCall.event.CallIn){NCCCall.onCallIn(g.data)}else{if(NCCCall.onEstablish&&m==NCCCall.event.Establish){NCCCall.onEstablish(g.data)}else{if(NCCCall.onStateChanged&&m==NCCCall.event.StateChanged){NCCCall.onStateChanged(g.data)}else{if(NCCCall.onRecord&&m==NCCCall.event.Record){NCCCall.onRecord(g.data)}}}}}}}}catch(j){}}}try{for(var k in NCCCall.actionListener.allData){NCCCall.actionListener.allData[k]["fnCallBack"](c.data,g)}}catch(j){}}};NCCCall.SPhone=function(){};NCCCall.SPhone.action=function(b,a){$.ajax({url:"http://127.0.0.1:9558/api",data:{cmd:b},type:"post",cache:false,contentType:"application/x-www-form-urlencoded; charset=GBK",dataType:"json",success:function(c){try{a(c.responseText)}catch(d){}},error:function(c){try{a(c.responseText)}catch(d){}}})};NCCCall.logon=function(){NCCCall.op.login(function(g,f){IS_SOCKETCS_CLOSE=false;if(f.data.result.toUpperCase()=="SUCC"){NCCCall.dataAction.token=f.data.token;NCCCall.currInfo.termId=f.data.termId;$("#home_page_terminal_no").html(NCCCall.currInfo.termId);var a=G_STAFF_INFO.WORK_AFTER_CALL_TIME;var c=G_STAFF_INFO.AUTO_OFFHOOK;if(parseInt(a)>0){NCCCall.op.SetValue("WORK_AFTER_CALL_TIME",a,null)}if(parseInt(c)>0){NCCCall.op.SetValue("AUTO_OFFHOOK",c,null)}}else{$("#state_time_count").countTimer("reset");NCCCall.currInfo.state=1;var b=NCCCall.state.a(1);NCCCall.el.stateTx.html(b.c);var h=b.i;if(h==undefined||h==""){h=b[NCCCall.currInfo.callType]}NCCCall.el.setAllDisabled();if(b.btSts!=undefined){for(var d=0;d<b.btSts.length;d++){var e=NCCCall.el.tools[b.btSts[d]];if(e!=undefined){e.el.text(e.t).removeClass().addClass("btn btn-default").addClass(e.c).unbind("click").click(e.e).attr("disabled",e.disabled)}}}$("#paag_logo >a").attr("data-original-title",f.data.remark)}})};NCCCall.onTimer=function(){if(NCCCall.currInfo.state==1){NCCCall.logon()}if(SOCKETCS.readyState==1){NCCCall.op.GetValue("AGENT_STATE",function(d,c){if(c.data.result.toUpperCase()=="SUCC"&&"AGENT_STATE"==c.data.paramName){var a=c.data.paramValue.split("|");var b=a[0];if(b!=NCCCall.currInfo.state){console.log("Wrong state local="+NCCCall.currInfo.state+" server="+c.data.paramValue)}}})}};NCCCall.init=function(){var c=G_STAFF_INFO.WS_ADDR;try{SOCKETCS=null;SOCKETCS=new WebSocket(c);NCCCall.log("Socket Status: ",SOCKETCS.readyState);SOCKETCS.onopen=function(){NCCCall.log("Socket Status: ",SOCKETCS.readyState+" (open)");SOCKETCS.send("I'm "+G_STAFF_INFO.STAFF_NAME);setTimeout(NCCCall.logon,1000)};SOCKETCS.onmessage=function(k){if(typeof(k.data)!="string"){NCCCall.log("Server reply:"," binary data len= "+k.data.size);var d=new FileReader();d.onload=function(m){if(m.target.readyState==FileReader.DONE){var e=m.target.result;NCCCall.log("Server reply : ",e)}};d.readAsText(k.data);return}var j="";j=k.data;var l=j.substr(0,1);var i=j.indexOf("|");var g="";var f="";if(i!=-1){g=j.substr(1,i-1);f=j.substr(i+1)}else{g=j.substr(1)}if(l=="0"){NCCCall.log("Server reply : ",g)}else{if(l=="1"){NCCCall.log("Server echo msg : ",g)}else{if(l=="2"){NCCCall.log(g+" said : ",f)}else{if(l=="3"){NCCCall.log(g+" broadcasted : ",f)}else{if(l=="4"){NCCCall.log("Server streamed : ",g)}else{if(j.substr(6,10)=="AgentState"){}else{NCCCall.log("Server reply : ",j)}}}}}}try{NCCCall.actionListener.doListener(k)}catch(h){}};SOCKETCS.onclose=function(){try{NCCCall.log("Socket Status: ",SOCKETCS.readyState+" (Closed)");if(IS_SOCKETCS_CLOSE){NCCCall.el.stateTx.html("网络中断")}else{NCCCall.el.stateTx.html("网络断开")}$("#state_time_count").countTimer("reset")}catch(d){}if(!IS_SOCKETCS_CLOSE){setTimeout(function(){NCCCall.init()},5000)}};SOCKETCS.onerror=function(){try{NCCCall.log("on error Socket Status: ",SOCKETCS.readyState+" (Closed)")}catch(d){}};if(g_nMainTimerId==null){g_nMainTimerId=setInterval(NCCCall.onTimer,30000)}}catch(b){NCCCall.log("Error",b)}function a(){}};NCCCall.currInfo={state:NCCCall.state.D.stNull,callType:"",termId:"",ani:"",dnis:"",callId:"",taskId:""};NCCCall.open=function(){NCCCall.log("NCCCall startup");NCCCall.dataAction.staffId=G_STAFF_INFO.STAFF_ID;NCCCall.dataAction.companyId=G_STAFF_INFO.COMPANY_ID;$("#state_time_count").countTimer({startAt:0});NCCCall.el.init();NCCCall.el.setAllDisabled();if(G_STAFF_INFO.LOGON_TYPE=="1"){G_STAFF_INFO.BIND_PHONE=G_STAFF_INFO.SOFT_PHONE;$("#main_bind_phone").html("软电话接听");mainPageListener();mainPageSipState()}else{if(G_STAFF_INFO.LOGON_TYPE=="2"){if(G_STAFF_INFO.SOFT_PHONE!=null&&G_STAFF_INFO.SOFT_PHONE.length>0&&G_STAFF_INFO.ADDRESS!=null&&G_STAFF_INFO.ADDRESS!="null"){G_STAFF_INFO.BIND_PHONE=G_STAFF_INFO.SOFT_PHONE;$("#main_bind_phone").html("SIP话机:"+G_STAFF_INFO.BIND_PHONE);mainPageListener()}else{NCCCall.log("SOFT_PHONE or SIP ADDRESS is null.")}}else{if(G_STAFF_INFO.LOGON_TYPE=="3"){if(G_STAFF_INFO.CONN_NBR!=null&&G_STAFF_INFO.CONN_NBR.length>0){G_STAFF_INFO.BIND_PHONE=G_STAFF_INFO.CONN_NBR;$("#main_bind_phone").html(G_STAFF_INFO.BIND_PHONE);mainPageListener()}else{NCCCall.log("SOFT_PHONE is null.")}}else{NCCCall.log("NCCCall init, unknown LOGON_TYPE.")}}}};function mainPageListener(){NCCCall.init();NCCCall.actionListener.addAllEventListener("StateChanged",function(e,d){if(d.msgAction=="Establish"){NCCCall.currInfo.ani=d.data["ani"];NCCCall.currInfo.dnis=d.data["dnis"];NCCCall.currInfo.callId=d.data["callId"]}if(d.msgAction!="StateChanged"){return}$("#state_time_count").countTimer("reset");NCCCall.currInfo.state=d.data["state"];var a=NCCCall.state.a(d.data["state"]);NCCCall.el.stateTx.html(a.c);var f=a.i;if(f==undefined||f==""){f=a[NCCCall.currInfo.callType]}NCCCall.el.setAllDisabled();if(a.btSts!=undefined){for(var b=0;b<a.btSts.length;b++){var c=NCCCall.el.tools[a.btSts[b]];if(c!=undefined){if(a.btSts[b]==NCCCall.el.D.btThreeLink){NCCCall.el.bt.btThreeLink.show()}else{if(a.btSts[b]==NCCCall.el.D.btTransferCall){NCCCall.el.bt.btTransferCall.show()}else{if(a.btSts[b]==NCCCall.el.D.btHelp){NCCCall.el.bt.btHelp.show()}else{c.el.text(c.t).unbind("click").click(c.e).css("display","block")}}}}}}if(NCCCall.currInfo.state=="6"){NCCCall.el.bt.btSetBusy.css("display","block");NCCCall.el.bt.btSetUnBusy.hide();t_btn_state=true}else{if(NCCCall.currInfo.state=="7"){NCCCall.el.bt.btSetBusy.hide();NCCCall.el.bt.btSetUnBusy.css("display","block");t_btn_state=false}else{if(NCCCall.currInfo.state=="0"||NCCCall.currInfo.state=="1"||NCCCall.currInfo.state=="2"||NCCCall.currInfo.state=="3"||NCCCall.currInfo.state=="4"||NCCCall.currInfo.state=="5"){NCCCall.el.bt.btSetBusy.hide();NCCCall.el.bt.btSetUnBusy.hide()}}}if(G_STAFF_INFO.CALLIN_NOTIFY=="1"&&d.data["state"]!=NCCCall.state.D.stIncoming){if(G_STAFF_INFO.AUTO_OFFHOOK=="1"&&d.data["state"]==NCCCall.state.D.stLink){}else{hideCallInNotification()}}if(G_STAFF_INFO.AUTO_OFFHOOK=="0"&&media_play==1&&d.data["state"]!=NCCCall.state.D.stIncoming){Media.pause()}if(G_STAFF_INFO.AUTO_OFFHOOK=="0"&&d.data["state"]==NCCCall.state.D.stIncoming){if(G_STAFF_INFO.OFFHOOK_VOICE_ADDRESS!=""){Media.src=G_STAFF_INFO.OFFHOOK_VOICE_ADDRESS;Media.play();media_play=1}}});NCCCall.actionListener.addAllEventListener("Kickout",function(d,b){if(b.msgAction!="Kickout"){return}var c=b.data["ip"];var a=b.data["reason"];if(mainPageSipStateId!=null){clearTimeout(mainPageSipStateId)}alert(a);NCCCall.op.logoutOutline(function(f,e){})});NCCCall.actionListener.addAllEventListener("Enforced",function(c,b){if(b.msgAction!="Enforced"){return}var a=b.data["action"];if(a=="1"){alert("强制示忙")}else{if(a=="2"){alert("强制示闲")}else{if(a=="3"){alert("强制挂机")}}}});NCCCall.actionListener.addAllEventListener("CallIn",function(d,c){if(c.msgAction!="Callin"){return}var b=c.data["direction"];var a=c.data["type"];if(parseInt(b)==1||parseInt(a)==3){return}NCCCall.currInfo.taskId=parseInt(getFieldFromCallData(c.callData,"TASK="));console.log("taskId:"+NCCCall.currInfo.taskId);$("#main_call_menu").show();$("#main_callin_title").show();$("#main_callout_title").hide();G_STAFF_INFO.CALLER=c.data.ani;G_STAFF_INFO.CALL_ID=c.data.callId;G_STAFF_INFO.CALL_SEQ=c.data.callSub;G_STAFF_INFO.CALL_TIME=c.data.callTime});NCCCall.actionListener.addAllEventListener("CallOut",function(b,a){if(a.msgAction!="CallOut"){return}G_STAFF_INFO.CALLEE=a.data["dnis"];G_STAFF_INFO.CALL_ID=a.data["callId"];G_STAFF_INFO.CALL_SEQ="0";G_STAFF_INFO.CALL_TIME=a.data["callTime"];if(a.data["resultDesc"].indexOf("呼出失败:9")>=0){ncctools.error(a.data["resultDesc"])}});NCCCall.actionListener.addAllDataListener("socketMonitor",function(b,a){})}function mainPageSipState(){return;if(G_STAFF_INFO.LOGON_TYPE=="1"){NCCCall.SPhone.action("get-state",function(d){NCCCall.log("状态返回值:",d);if(d.indexOf("0")==0){var b=d.split("|");var a=b[0];var c=b[1];if(c=="0"){mainPageSipRegistrar();$("#main_bind_phone").html("软电话:"+G_STAFF_INFO.BIND_PHONE)}else{if(a.indexOf(G_STAFF_INFO.BIND_PHONE)<0&&G_STAFF_INFO.BIND_PHONE!=""){mainPageSipRegistrar();$("#main_bind_phone").html("软电话:"+G_STAFF_INFO.BIND_PHONE)}else{if(a.indexOf(G_STAFF_INFO.BIND_PHONE)>0&&c=="1"){$("#main_bind_phone").html("软电话:"+G_STAFF_INFO.BIND_PHONE+"(未连接-2)")}else{if(a.indexOf(G_STAFF_INFO.BIND_PHONE)>0&&parseInt(c)>=2){$("#main_bind_phone").html("软电话:"+G_STAFF_INFO.BIND_PHONE)}else{if(G_STAFF_INFO.BIND_PHONE==""){mainPageSipUnregistrar()}}}}}}else{$("#main_bind_phone").html("软电话:"+G_STAFF_INFO.BIND_PHONE+"(未连接-1)")}})}mainPageSipStateId=setTimeout("mainPageSipState()",10000)}function mainPageSipRegistrar(){var a="--registrar=sip:"+G_STAFF_INFO.ADDRESS+"\n--id=sip:"+G_STAFF_INFO.SOFT_PHONE+"@"+(G_STAFF_INFO.ADDRESS).split(":")[0]+"\n--realm=*\n--username="+G_STAFF_INFO.SOFT_PHONE+"\n--password="+G_STAFF_INFO.TERM_SERIAL_NO+"\n--internet=1";NCCCall.SPhone.action(a,null)}function mainPageSipUnregistrar(){NCCCall.SPhone.action("--unregister",null)}function newSetState(){var a=t_btn_state;NCCCall.op.setBusy(a,function(c,b){if(b.data.result.toUpperCase()=="SUCC"){if(a){NCCCall.el.bt.btSetBusy.hide();NCCCall.el.bt.btSetUnBusy.css("display","block");t_btn_state=false}else{NCCCall.el.bt.btSetBusy.css("display","block");NCCCall.el.bt.btSetUnBusy.hide();t_btn_state=true}}})}function newThreeLinkSeat(){var a;NCCCall.modal.selectSeat(function(b){a=b;NCCCall.op.confCallPro("1",a,function(d,c){})})}function newThreeLinkPhone(){var a;NCCCall.modal.inputPhone(function(b){a=b;NCCCall.op.confCallPro("3",a,function(d,c){})})}function newTransferCallSeat(a){var b;NCCCall.modal.selectSeat(function(c){b=c;NCCCall.op.transferCallPro("1",b,a,function(e,d){})})}function newTransferCallPhone(a){var b;NCCCall.modal.inputPhone(function(c){b=c;NCCCall.op.transferCallPro("3",b,a,function(e,d){})})}function getTtsPlay(b){var a="--tts-play="+b;NCCCall.SPhone.action(a,null)}function getFieldFromCallData(b,a){var d=b.indexOf(a);if(d>=0){var c=b.substring(d+a.length);var e=c.split("\x01");return e[0]}else{return""}}var g_callInNotification=null;function showCallInNotification(a,c,d,b){if(g_callInNotification){g_callInNotification.close();g_callInNotification=null}if(!("Notification" in window)){return}if(Notification.permission=="denied"){return}else{if(Notification.permission!="granted"){if(!d){return}Notification.requestPermission(function(f){console.log("status: "+f);console.log("permission: "+Notification.permission);showCallInNotification(a,c,false,b)})}}var e=new Notification(a,{icon:"icon1.png",body:c,silent:false});g_callInNotification=e;e.onclick=function(){if(b){b()}e.close()};e.onclose=function(){if(this==g_callInNotification){g_callInNotification=null}}}function hideCallInNotification(){if(g_callInNotification){g_callInNotification.close();g_callInNotification=null}};